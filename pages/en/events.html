<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Upcoming Events | KJ's Camping</title>
  <link rel="stylesheet" href="../styles/events.css">
  <link rel="stylesheet" href="../../styles/evenementen.css">
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
  <!-- Dynamic header goes here -->
  <div id="header-placeholder"></div>
  <main id="page-content" class="fade-container">
    <h1 data-key="upcomingEvents">Upcoming Events</h1>
    <div id="calendar-root"></div>
  </main>
  <!-- Footer fragment -->
  <div id="footer-placeholder"></div>
  
  <script>
    // Load header/footer first, then start header.js for language switching
    Promise.all([
      fetch('../components/header.html').then(r => r.text()).then(h => {
        document.querySelector('#header-placeholder').innerHTML = h;
      }),
      fetch('../components/footer.html').then(r => r.text()).then(h => {
        document.querySelector('#footer-placeholder').innerHTML = h;
      })
    ]).then(() => {
      const year = document.getElementById('year');
      if (year) year.textContent = new Date().getFullYear();
      const headerScript = document.createElement('script');
      const base = window.location.pathname.split('/pages')[0];
      headerScript.type = 'module';
      headerScript.src = `${base}/scripts/header.js`;
      document.body.appendChild(headerScript);
    });
  </script>
<!-- React calendar (adapted from Evenementen.js) -->
<script type="text/babel">
const { useState, useEffect } = React;

/* ===================== CONFIG ===================== */
const GOOGLE_CALENDAR_API_KEY = 'REPLACE_WITH_YOUR_KEY';
const CALENDAR_ID            = 'REPLACE_WITH_YOUR_CALENDAR_ID';

/* ===================== COMPONENT =================== */
function Calendar() {
  const currentDate = new Date();
  const [month, setMonth]     = useState(currentDate.getMonth());
  const [year,  setYear]      = useState(currentDate.getFullYear());
  const [events,setEvents]    = useState([]);
  const [loading,setLoading]  = useState(true);
  const [selected,setSelected]= useState(null);

  /* ---- fetch events whenever month / year changes ---- */
  useEffect(() => {
    (async () => {
      setLoading(true);
      try {
        const startISO = new Date(year, month, 1).toISOString();
        const endISO   = new Date(year, month + 1, 0, 23, 59, 59).toISOString();
        const url = `https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(CALENDAR_ID)}/events?key=${GOOGLE_CALENDAR_API_KEY}&timeMin=${startISO}&timeMax=${endISO}&singleEvents=true&orderBy=startTime`;
        const res = await fetch(url);
        const data = await res.json();
        setEvents(data.items ?? []);
      } catch (err) { console.error(err); }
      setLoading(false);
    })();
  }, [month, year]);

  /* ---- helpers ---- */
  const monthNames = ['January','February','March','April','May','June','July','August','September','October','November','December'];
  const dayNames   = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];

  function changeMonth(diff){
    let m = month + diff, y = year;
    if (m < 0) { m = 11; y--; }
    if (m > 11){ m = 0;  y++; }
    setMonth(m); setYear(y);
  }

  /* ---- build calendar grid ---- */
  const firstIdx     = new Date(year, month, 1).getDay();
  const daysInMonth  = new Date(year, month+1, 0).getDate();
  const cells = Array.from({length:42}, (_,i) => i-firstIdx+1)
                     .map(d => (d>0 && d<=daysInMonth)? d : null);

  function cellContent(day){
    if(!day) return null;
    const iso = `${year}-${String(month+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
    const todaysEvents = events.filter(ev=>{
      const evDate = (ev.start.date || ev.start.dateTime).split('T')[0];
      return evDate === iso;
    });
    return (
      <div className="calendar-cell">
        <div className="date-number">{day}</div>
        <div className="events">
          {todaysEvents.map(ev=>(
            <div key={ev.id} className="event" onClick={()=>setSelected(ev)}>
              {ev.summary}
            </div>
          ))}
        </div>
      </div>
    );
  }

  return (
    <div className="calendar-container">
      <div className="calendar-header">
        <button className="nav-button" onClick={()=>changeMonth(-1)}>Prev</button>
        <h2 className="month-year">{monthNames[month]} {year}</h2>
        <button className="nav-button" onClick={()=>changeMonth(1)}>Next</button>
      </div>

      {loading
        ? <p>Evenementen worden geladen...</p>
        : (
            <table className="calendar-table">
              <thead>
                <tr>{dayNames.map(d=><th key={d}>{d}</th>)}</tr>
              </thead>
              <tbody>
                {Array.from({length:6},(_,r)=>(
                  <tr key={r}>
                    {cells.slice(r*7, r*7+7).map((day,c)=>(
                      <td key={c}>{cellContent(day)}</td>
                    ))}
                  </tr>
                ))}
              </tbody>
            </table>
          )
      }

      {selected && (
        <div className="modal-overlay" onClick={()=>setSelected(null)}>
          <div className="modal-content" onClick={e=>e.stopPropagation()}>
            <h2>{selected.summary}</h2>
            <p><strong>Start:</strong> {new Date(selected.start.dateTime || selected.start.date).toLocaleString('nl-NL')}</p>
            {selected.end && (
              <p><strong>Eind:</strong> {new Date(selected.end.dateTime || selected.end.date).toLocaleString('nl-NL')}</p>
            )}
            {selected.location && (<p><strong>Locatie:</strong> {selected.location}</p>)}
            {selected.description && (<p>{selected.description}</p>)}
            <button className="close-button" onClick={()=>setSelected(null)}>Sluiten</button>
          </div>
        </div>
      )}
    </div>
  );
}

/* ---- mount ---- */
ReactDOM.createRoot(document.getElementById('calendar-root'))
        .render(React.createElement(Calendar));
</script>
<script src="../../scripts/main.js"></script>
</body>
</html>